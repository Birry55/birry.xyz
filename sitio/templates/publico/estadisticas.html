{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="author" content="Juan Josè Berrio Galeano">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadisticas / Analisis de Datos</title>
    <link rel="icon" type="image/icon" href="{% static 'sitio/images/asesoria.png' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700"> 
    <link rel="stylesheet" href="{% static 'sitio/fonts/icomoon/style.css' %}">
    <link rel="stylesheet" href="{% static 'sitio/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap carrusel CSS -->
    <link rel="stylesheet" href="{% static 'sitio/css/style.css' %}">
    <link href="{% static 'sitio/css/carousel.css' %}" rel="stylesheet">
</head>

<style>
    body {
        background: #fff;
        color: #000;
    }
</style>

<body>
    <div class="col-md">
        <div class="mt-2 row col-md">
            <div class="text-center col-md-8">
                <h2 class="mt-3">Estadisticas / Analisis de Datos</h2>
                <a href="http://localhost:8000/juanjoseberriogaleano/" class="text-success btn icon-book" title="Principal" aria-label="principal"></a>
            </div>
            <div class="text-center col-md">
                <img src="{% static 'sitio/images/logotiba.png' %}" alt="imagen logo tiba" style="height: 100px">
            </div>
        </div>
        <hr class="bg-success">
    </div>

    <div class="col-md">
        <ul id="myTab" class="nav nav-tabs mt-2">                            
            <li class="nav-item">
                <a href="#datos" class="btn active icon-table border" data-toggle="tab"><font size=""> Datos</font></a>
            </li>
            <li class="nav-item">
                <a href="#estadisticai" class="btn icon-line-chart border" data-toggle="tab"> <font size=""> Estadisticas</font></a>
            </li>
        </ul>
    </div>

    <div class="tab-content sistema col-md mt-2 mb-4" style="font-size: 110%;">
        <div class="tab-pane active col-md" id="datos">
            <h4 class="text-center mt-2"> Datos</h4>
            <hr class="bg-success">

            <!-- Primer formulario para el número de variables -->
            <form id="formVariables">
                <div class="row">
                    <div class="col-md-6">
                        <label for="var" class="icon-minus"> Número de variables</label>
                        <input class="form-control" type="number" name="var" id="var" placeholder="Número de variables (1-10)" min="1" max="10" required>
                    </div>
                    <div class="boton col-md-6 mt-2">
                        <button type="submit" class="btn btn-primary">Crear variables</button>
                    </div>
                </div>
            </form>
            <hr>

            <!-- Segundo formulario para ingresar los nombres de las variables -->
            <form id="formNombres" class="row">
            </form>
            <hr>

            <!-- Div para mostrar la tabla -->
            <div class="tabla table-responsive mt-3">
                <table class="table table-striped table-bordered" id="myTable"></table>
            </div>
        </div>

        <div class="tab-pane col-md" id="estadisticai">
            <h4 class="text-center mt-2"> Estadisticas</h4>
            <hr class="bg-success">

            <div class="text-center">
                <details class="mt-2">
                    <summary class="btn icon-list-alt "> Estadisticas Descriptivas </summary><hr>
                    <!-- Agregar botón Resumen -->
                    <button id="btnResumen" class="btn icon-calculator -alt mt-3"> Calcular</button>
                    <!-- Área para mostrar el resumen -->
                    <div id="resumenArea" class="mt-3 "></div><hr>

                </details>

                <details class="mt-2">
                    <summary class="btn icon-line-chart "> Analisis de regresion </summary><hr>
                    <!-- Agregar botón Resumen -->
                    <button id="btnResumen" class="btn icon-calculator -alt mt-3"> Calcular</button>
                    <!-- Área para mostrar el resumen -->
                    <div id="resumenArea" class="mt-3 "></div>

                </details>



            </div>
        </div>

    </div>


    <footer class="site-footer border-top">
        <ul class="container text-muted">
            <li></li>

        </ul><hr>
        <div class ="text-muted text-center text-small">




            <p class="mb-1 text">&copy; 2024  todos los derechos reservados.<span><br>Desarrollado Por <a href="https://wa.me/573158979052" class="border-bottom text-success" target="_blank">Birry</a></span></p>
        </div>
    </footer>



        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
        <script src="{% static 'sitio/js/jquery-3.3.1.min.js' %}"></script>
        <script src="{% static 'sitio/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'sitio/js/mincostos.js' %}"></script>
        <script src="{% static 'sitio/js/moment.js' %}"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var form1 = document.getElementById('formVariables');
                var form2 = document.getElementById('formNombres');
                var table = document.getElementById('myTable');
                var numVariables;

                form1.addEventListener('submit', function (event) {
                    event.preventDefault();
                    numVariables = parseInt(document.getElementById('var').value);

                    if (numVariables <= 0 || numVariables > 10) {
                        alert('Por favor, ingrese un número válido de variables (1-10).');
                        return;
                    }

                    crearFormularioNombres(numVariables);
                });

                form2.addEventListener('submit', function (event) {
                    event.preventDefault();
                    var maxObservaciones = parseInt(document.getElementById('observaciones').value);
                    crearTablaConNombres(numVariables, maxObservaciones);
                });

                function crearFormularioNombres(numVariables) {
                    form2.innerHTML = '';

                    for (var i = 1; i <= numVariables; i++) {
                        var divWrapper = document.createElement('div');
                        divWrapper.className = 'col-md-6 mt-2';

                        var label = document.createElement('label');
                        label.textContent = 'Nombre de la variable ' + i;
                        label.for = 'vari' + i;

                        var input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'form-control';
                        input.name = 'vari' + i;
                        input.id = 'vari' + i;
                        input.placeholder = 'Nombre de la variable ' + i;
                        input.required = true;

                        divWrapper.appendChild(label);
                        divWrapper.appendChild(input);
                        form2.appendChild(divWrapper);
                    }

                    var divObservaciones = document.createElement('div');
                    divObservaciones.className = 'col-md-6 mt-2';

                    var labelObservaciones = document.createElement('label');
                    labelObservaciones.className = "icon-list";
                    labelObservaciones.textContent = ' Número de observaciones';
                    labelObservaciones.for = 'observaciones';

                    var inputObservaciones = document.createElement('input');
                    inputObservaciones.type = 'number';
                    inputObservaciones.className = 'form-control';
                    inputObservaciones.name = 'observaciones';
                    inputObservaciones.id = 'observaciones';
                    inputObservaciones.placeholder = 'Número de observaciones (max: 500)';
                    inputObservaciones.required = true;

                    divObservaciones.appendChild(labelObservaciones);
                    divObservaciones.appendChild(inputObservaciones);
                    form2.appendChild(divObservaciones);

                    var button = document.createElement('button');
                    button.type = 'submit';
                    button.className = 'btn btn-success mt-3';
                    button.textContent = 'Crear Tabla';
                    form2.appendChild(button);
                }

                function crearTablaConNombres(numVariables, maxObservaciones) {
                    table.innerHTML = '';

                    var nombresVariables = [];
                    for (var i = 1; i <= numVariables; i++) {
                        var nombreVariable = document.getElementById('vari' + i).value;
                        nombresVariables.push(nombreVariable);
                    }

                    var thead = document.createElement('thead');
                    table.appendChild(thead);

                    var headerRow = thead.insertRow(0);

                    var counterCell = headerRow.insertCell(0);
                    counterCell.textContent = 'No.';

                    for (var j = 0; j < nombresVariables.length; j++) {
                        var headerCell = headerRow.insertCell(j + 1);
                        headerCell.textContent = nombresVariables[j];
                    }

                    var tbody = document.createElement('tbody');
                    table.appendChild(tbody);

                    for (var k = 1; k <= maxObservaciones; k++) {
                        var row = tbody.insertRow(k - 1);

                        var counterCell = row.insertCell(0);
                        counterCell.textContent = k;

                        for (var l = 0; l < numVariables; l++) {
                            var cell = row.insertCell(l + 1);

                            var input = document.createElement('input');
                            input.type = 'text';
                            input.className = 'form-control';
                            input.name = 'dato_' + k + '_var' + (l + 1);
                            input.placeholder = 'Dato ' + k + ' Variable ' + (l + 1);
                            input.required = true;

                            cell.appendChild(input);
                        }
                    }
                }

                 // Después de la función crearTablaConNombres
                function calcularResumen() {
                    var resumenArea = document.getElementById('resumenArea');
                    var tbody = table.querySelector('tbody');
                    var numVariables = tbody.rows[0].cells.length - 1; 
         // Restar 1 para excluir la columna de contador

                    resumenArea.innerHTML = '<h5>Resumen Estadístico</h5>';

                    for (var i = 1; i <= numVariables; i++) {
                        var datos = obtenerDatosDeColumna(i);

             // Calcular la media, moda, desviación estándar, etc.
                        var media = calcularMedia(datos);
                        var moda = calcularModa(datos);
                        var desviacionEstandar = calcularDesviacionEstandar(datos);
                        var numeroObservaciones = datos.length;
                        var valorMinimo = Math.min(...datos);
                        var valorMaximo = Math.max(...datos);


// Cambia i por el nombre de la variable (puedes obtenerlo desde el formulario)
                        var nombreVariable = obtenerNombreVariable(i);                        

                  // Mostrar el resumen en el área correspondiente
                        resumenArea.innerHTML += `
                        <div class="tabla table-responsive mt-3">
                        <table class="table table-striped table-bordered" id="myTable">
                        <thead>
                        <tr>
                        <th> Variable </th>
                        <th> Obs</th>
                        <th> Media </th>
                        <th> Des.Est. </th>
                        <th> Valor Mínimo</th>
                        <th> Valor Máximo</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                        <td>${nombreVariable}</td>
                        <td>${numeroObservaciones}</td>
                        <td>${media.toLocaleString()}</td>
                        <td>${desviacionEstandar.toLocaleString()}</td>
                        <td>${valorMinimo.toLocaleString()}</td>
                        <td>${valorMaximo.toLocaleString()}</td>
                        </tr>
                        </tbody>
                        </table>
                        </div>
                        `;
                    }
                }

// Función para obtener el nombre de la variable desde el formulario
                function obtenerNombreVariable(indice) {
                    var inputNombre = document.getElementById('vari' + indice);
                    return inputNombre.value || 'Variable ' + indice;
                }


           // Función para obtener datos de una columna específica
                function obtenerDatosDeColumna(columnIndex) {
                    var datos = [];
                    var tbody = table.querySelector('tbody');

                    for (var i = 0; i < tbody.rows.length; i++) {
                        var cell = tbody.rows[i].cells[columnIndex];
                        var inputValue = cell.querySelector('input').value;
                        datos.push(parseFloat(inputValue));
                    }

                    return datos;
                }


        // Funciones auxiliares para cálculos estadísticos (puedes agregar más según sea necesario)
                function calcularMedia(datos) {
                    var suma = datos.reduce((total, dato) => total + dato, 0);
                    return suma / datos.length;
                }

                function calcularModa(datos) {
            // Implementar lógica para calcular la moda (puedes usar bibliotecas externas)
            // Devolver un mensaje si no hay una moda clara
                    return "Moda no disponible";
                }

                function calcularDesviacionEstandar(datos) {
                    var media = calcularMedia(datos);
                    var sumaCuadrados = datos.reduce((total, dato) => total + Math.pow(dato - media, 2), 0);
                    return Math.sqrt(sumaCuadrados / datos.length);
                }

        // Luego, dentro del evento click del botón Resumen
                document.getElementById('btnResumen').addEventListener('click', function () {
            // Obtener los datos de la tabla
                    var datos = obtenerDatosDeTabla();

            // Validar datos antes de calcular el resumen
                    if (!validarDatosParaResumen(datos)) {
                        alert('Por favor, complete todos los datos en la tabla antes de calcular el resumen.');
                        return;
                    }

            // Calcular y mostrar el resumen
                    calcularResumen(datos);
                });

        // Función para validar datos en la tabla antes de calcular el resumen
                function validarDatosParaResumen(datos) {
            // Implementar lógica de validación según tus requisitos
            // Por ejemplo, verificar si todos los datos son números y están presentes
                    return datos.every(dato => !isNaN(dato) && dato !== '');
                }

        // Función para obtener datos de la tabla
                function obtenerDatosDeTabla() {
                    var datos = [];
                    var tbody = table.querySelector('tbody');

                    for (var i = 0; i < tbody.rows.length; i++) {
                        for (var j = 1; j < tbody.rows[i].cells.length; j++) {
                            var input = tbody.rows[i].cells[j].querySelector('input');
                            datos.push(parseFloat(input.value));
                        }
                    }

                    return datos;
                }

            });
        </script>



    </body>
    </html>
